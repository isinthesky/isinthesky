# BGP (Border Gateway Protocol) 자세한 설명

BGP(Border Gateway Protocol)는 인터넷의 핵심 라우팅 프로토콜로, 서로 다른 네트워크 운영 단위인 자율 시스템(Autonomous Systems, AS) 간에 라우팅 정보를 교환하는 역할을 합니다. BGP는 **경로 벡터(Path Vector) 프로토콜**로 분류되며, 네트워크 내에서 가능한 다양한 경로의 정보와 속성을 고려하여 최적의 경로를 선택하도록 설계되어 있습니다.

## 1. BGP의 기본 개념

- **자율 시스템(AS):**  
  인터넷은 수많은 자율 시스템으로 구성되어 있으며, 각 자율 시스템은 자체적인 라우팅 정책과 운영 도메인을 가집니다. 예를 들어, ISP, 대규모 기업, 교육기관 등은 모두 별도의 AS를 운영할 수 있습니다. BGP는 이러한 AS 간에 라우팅 정보를 주고받아 전 세계 인터넷 경로를 형성합니다.

- **경로 벡터 프로토콜:**  
  BGP는 라우팅 경로를 단순하게 목적지 IP 주소만을 전달하는 것이 아니라, 경로 상의 AS 순서를 포함하는 경로 벡터 정보를 함께 전송합니다. 이를 통해  

  $$
  \text{AS Path} = \{AS_1, AS_2, \dots, AS_n\}
  $$

  과 같이 경로 내에 존재하는 AS들을 기록하여, 루프 방지 및 정책 기반의 경로 선택을 가능하게 합니다.

## 2. BGP의 동작 방식

BGP는 TCP 포트 \(179\)를 사용해 피어(peer) 간 신뢰성 있는 연결을 수립합니다. 피어 간에 연결된 후, 다음과 같은 다양한 메시지 유형을 통해 정보를 주고받습니다:

- **OPEN 메시지:**  
  - 피어 간 초기 연결을 설정할 때 사용합니다.
  - 버전 번호, AS 번호, BGP 식별자(일반적으로 라우터 ID), 그리고 Hold Time 등의 정보를 포함합니다.

- **UPDATE 메시지:**  
  - 새로운 경로 광고 또는 기존 경로 철회 등의 변경 사항을 전달합니다.
  - 경로 속성(AS Path, Next Hop, MED 등)이 포함되어, 라우팅 결정에 중요한 역할을 합니다.

- **KEEPALIVE 메시지:**  
  - 연결이 유효함을 지속적으로 확인하기 위해 주기적으로 전송됩니다.
  - 피어와의 연결이 끊어지지 않았음을 보장합니다.

- **NOTIFICATION 메시지:**  
  - 오류 상황이나 비정상적인 상태 발생 시 상대 피어에게 오류를 알리고 연결을 종료하기 위해 전송됩니다.

## 3. BGP의 경로 선택 및 정책

BGP는 단순히 최단 경로만 선택하는 것이 아니라, 네트워크 운영자가 지정한 다양한 정책을 반영하여 경로를 결정합니다. 주요 경로 선택 기준은 다음과 같습니다:

1. **Local Preference (로컬 선호도):**  
   라우터 내부에서 관리자가 설정한 값으로, 값이 높을수록 해당 경로가 우선 선택됩니다.

2. **AS Path (AS 경로):**  
   경로에 포함된 AS의 수를 고려합니다. 일반적으로 AS가 적은 경로가 선호되며, AS Path 정보를 통해 경로 루프를 방지할 수 있습니다.

3. **Origin (경로 생성 방식):**  
   경로 정보가 어떻게 유입되었는지를 나타내며, IGP (내부 게이트웨이 프로토콜), EGP (외부 게이트웨이 프로토콜), 혹은 Incomplete 값으로 구분됩니다.

4. **Multi-Exit Discriminator (MED):**  
   여러 경로가 동일한 AS로 진입할 경우, 외부에서 들어오는 트래픽의 우선 순위를 결정하는 지표로 사용됩니다. MED 값이 낮을수록 선호됩니다.

5. **기타 정책 요소:**  
   피어 간의 관계(예: 고객-서비스 제공자, 피어링 관계 등), 경로 안정성, 트래픽 부하, 그리고 네트워크 운영자의 추가 정책 등이 함께 고려됩니다.

이처럼, BGP는 여러 기준을 종합하여 가장 적합한 경로를 선택하고, 네트워크 전체의 라우팅 안정성을 유지합니다.

## 4. BGP의 특징 및 활용

- **정책 기반 라우팅:**  
  BGP는 단순히 기술적인 경로 선택뿐 아니라, 비즈니스 및 네트워크 운영상의 정책을 반영할 수 있습니다. 이를 통해 특정 AS와의 피어링 관계, 트래픽 분산, 비용 최적화 등의 다양한 목적을 달성할 수 있습니다.

- **확장성:**  
  전 세계 수많은 라우터와 경로 정보를 효율적으로 관리할 수 있도록 설계되어 있으며, 전 세계적인 인터넷의 스케일에 맞춰 동작할 수 있습니다.

- **보안 이슈:**  
  기본 BGP는 인증 메커니즘이 부족하기 때문에, BGP 하이재킹(BGP Hijacking)과 같은 보안 위협에 노출될 수 있습니다. 이를 보완하기 위해 **RPKI (Resource Public Key Infrastructure)** 와 같은 보안 확장 기술이 도입되고 있습니다.

- **CDN 및 Anycast와의 연계:**  
  BGP는 CDN 환경에서 Anycast 라우팅과 결합되어, 단일 IP 주소가 여러 지리적 위치에서 광고될 때 가장 최적의 경로를 선택하는 데 활용됩니다.

## 5. 요약

BGP는 인터넷 상의 자율 시스템 간 라우팅 정보를 교환하는 핵심 프로토콜로써, 다음과 같은 역할을 수행합니다:

- **경로 벡터 방식:** 경로 상의 AS 목록을 전달하여, 루프 방지 및 정책 기반 경로 선택을 가능하게 합니다.
- **메시지 교환:** OPEN, UPDATE, KEEPALIVE, NOTIFICATION 메시지를 통해 피어와 신뢰성 있는 연결을 유지하며 경로 정보를 갱신합니다.
- **정책 반영 라우팅:** 다양한 기준(로컬 선호도, AS Path, Origin, MED 등)을 사용하여, 네트워크 운영자가 원하는 정책을 반영한 경로 선택을 수행합니다.
- **보안 및 확장성:** 전 세계 인터넷의 복잡한 라우팅 환경을 지원하고, RPKI 등의 보안 기술을 통해 추가적인 보호를 제공합니다.

이러한 특징 덕분에 BGP는 오늘날 전 세계 인터넷의 안정성과 효율적인 데이터 전달을 보장하는 데 중요한 역할을 하고 있습니다.